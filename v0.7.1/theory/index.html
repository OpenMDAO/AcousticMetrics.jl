<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Theory · AcousticMetrics.jl</title><meta name="title" content="Theory · AcousticMetrics.jl"/><meta property="og:title" content="Theory · AcousticMetrics.jl"/><meta property="twitter:title" content="Theory · AcousticMetrics.jl"/><meta name="description" content="Documentation for AcousticMetrics.jl."/><meta property="og:description" content="Documentation for AcousticMetrics.jl."/><meta property="twitter:description" content="Documentation for AcousticMetrics.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">AcousticMetrics.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><a class="tocitem" href="../api/">API</a></li><li class="is-active"><a class="tocitem" href>Theory</a><ul class="internal"><li><a class="tocitem" href="#The-Fourier-Transform"><span>The Fourier Transform</span></a></li></ul></li><li><a class="tocitem" href="../sqa/">Software Quality Assurance</a></li><li><a class="tocitem" href="../dev/">Developer Notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Theory</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Theory</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/OpenMDAO/AcousticMetrics.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/OpenMDAO/AcousticMetrics.jl/blob/main/docs/src/theory.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="AcousticMetrics.jl"><a class="docs-heading-anchor" href="#AcousticMetrics.jl"><code>AcousticMetrics.jl</code></a><a id="AcousticMetrics.jl-1"></a><a class="docs-heading-anchor-permalink" href="#AcousticMetrics.jl" title="Permalink"></a></h1><h2 id="The-Fourier-Transform"><a class="docs-heading-anchor" href="#The-Fourier-Transform">The Fourier Transform</a><a id="The-Fourier-Transform-1"></a><a class="docs-heading-anchor-permalink" href="#The-Fourier-Transform" title="Permalink"></a></h2><h3 id="The-Basics"><a class="docs-heading-anchor" href="#The-Basics">The Basics</a><a id="The-Basics-1"></a><a class="docs-heading-anchor-permalink" href="#The-Basics" title="Permalink"></a></h3><p><code>AcousticMetrics.jl</code> uses the FFTW library, a very popular implementation of the fast Fourier transform (FFT) algorithm. The FFT is a method of computing the discrete Fourier transform (DFT) that reduces the computational complexity from <span>$n^2$</span> to <span>$n \log(n)$</span>, where <span>$n$</span> is the length of the input to the transform. <a href="http://www.fftw.org/fftw3_doc/The-1d-Discrete-Fourier-Transform-_0028DFT_0029.html#The-1d-Discrete-Fourier-Transform-_0028DFT_0029">FFTW&#39;s definition of the discrete Fourier transform</a> is</p><p class="math-container">\[  y_k = \sum_{j=0}^{n-1} x_j e^{-2 \pi \imath jk/n}\]</p><p>where <span>$\imath=\sqrt{-1}$</span>.</p><p>The goal of a Fourier transform is to take a function (let&#39;s call it a &quot;signal&quot;) and express it as a sum of sinusoids. Let&#39;s imagine we have a very simple signal</p><p class="math-container">\[p(t) = A \cos(ωt+φ)\]</p><p>where we call <span>$A$</span> the amplitude, <span>$ω$</span> the frequency, and <span>$φ$</span> the phase. <code>AcousticAnalogies.jl</code> is interested in (surprise!) acoustics, which are real numbers, so we&#39;ll assume that <span>$A$</span>, <span>$ω$</span>, and <span>$φ$</span> are all real. Say we evaluate that function <span>$n$</span> times over a period <span>$T$</span>, and assume that <span>$ω = 2πm/T$</span>, i.e., that the period of our signal is some integer fraction of the sampling period <span>$T$</span>, since</p><p class="math-container">\[\frac{2 π}{ω} = \frac{2 π}{\frac{2πm}{T}} = \frac{T}{m}.\]</p><p>We&#39;ll refer to each of those samples as <span>$p_j = p(t_j)$</span>, where <span>$t_j$</span> is the time at sample <span>$j$</span> and <span>$j$</span> is an index from <span>$0$</span> to <span>$n-1$</span>.</p><p>What is the discrete Fourier transform of our signal <span>$p_j$</span>? We should be able to figure that out if we can express our signal <span>$p(t)$</span> as something that looks like FFTW&#39;s definition of the DFT. How can we do that? Well, first we need to remember that</p><p class="math-container">\[\cos(α+β) = \cos(α)\cos(β) - \sin(α)\sin(β)\]</p><p>which lets us rewrite our signal as</p><p class="math-container">\[p(t) = A \cos(ωt+φ) = A\left[ \cos(ωt)\cos(φ) - \sin(ωt)\sin(φ) \right] = A \cos(φ)\cos(ωt) - A\sin(φ)\sin(ωt).\]</p><p>Now, if we also remember that</p><p class="math-container">\[e^{ix} = \cos(x) + \imath \sin(x).\]</p><p>we can replace <span>$\sin(ωt)$</span> with</p><p class="math-container">\[\sin(ωt) = \frac{e^{\imath ωt} - e^{-\imath ωt}}{2\imath} = \frac{-\imath e^{\imath ωt} + \imath e^{-\imath ωt}}{2}\]</p><p>and <span>$\cos(ωt)$</span> with</p><p class="math-container">\[\cos(ωt) = \frac{e^{\imath ωt} + e^{-\imath ωt}}{2}.\]</p><p>Throw all that together and we get</p><p class="math-container">\[p(t) = \frac{A}{2}\left[ \cos(φ) + \imath \sin(φ)\right] e^{\imath ωt} + \frac{A}{2}\left[ \cos(φ) - \imath \sin(φ)\right] e^{-\imath ωt}\]</p><p>This is looking much closer to the definition of the DFT that we started with. Next thing we need to do is realize that since we&#39;ve sampled our signal <span>$p(t)$</span> at <span>$n$</span> different times, equally spaced, over a time period <span>$T$</span>, then we can replace <span>$t$</span> with</p><p class="math-container">\[t_j = j \frac{T}{n} = j Δt\]</p><p>where <span>$T/n$</span> is <span>$Δt$</span>, the time step size. We&#39;ve previously said that <span>$ω=\frac{2πm}{T}$</span>, which implies that</p><p class="math-container">\[ω t_j = \left( \frac{2πm}{T} \right) \left(j \frac{T}{n} \right) = \frac{2πmj}{n}\]</p><p>So if we throw that in there, we find</p><p class="math-container">\[p(t_j) = p_j = \frac{A}{2}\left[ \cos(φ) + \imath \sin(φ)\right] e^{2π\imath jm/n} + \frac{A}{2}\left[ \cos(φ) - \imath \sin(φ)\right] e^{-2π\imath jm/n}\]</p><p>That&#39;s very close to the DFT definition. So what happens if we evaluate the DFT of that last expression? We&#39;ll call the discrete Fourier transform of the signal <span>$\hat{p}_k$</span>. So...</p><p class="math-container">\[\begin{aligned}
  \hat{p}_k &amp;= \sum_{j=0}^{n-1} p_j e^{-2 \pi \imath jk/n} \\
            &amp;= \sum_{j=0}^{n-1} \left( \frac{A}{2}\left[\cos(φ) + \imath \sin(φ) \right] e^{2π\imath jm/n} + \frac{A}{2}\left[\cos(φ) - \imath \sin(φ) \right] e^{-2π\imath jm/n} \right) e^{-2 \pi \imath jk/n} \\
            &amp;= \sum_{j=0}^{n-1} \left( \frac{A}{2}\left[\cos(φ) + \imath \sin(φ) \right] e^{2π\imath j(m-k)/n} + \frac{A}{2}\left[\cos(φ) - \imath \sin(φ) \right] e^{-2π\imath j(m+k)/n} \right) \\
            &amp;=\frac{A}{2}\left[\cos(φ) + \imath \sin(φ) \right] \sum_{j=0}^{n-1} e^{2π\imath j(m-k)/n} + \frac{A}{2}\left[\cos(φ) - \imath \sin(φ) \right] \sum_{j=0}^{n-1} e^{-2π\imath j(m+k)/n} 
\end{aligned}\]</p><p>Pretty close now. Let&#39;s think about those two summations in the last expression. First assume that <span>$m - k = q \ne 0$</span>, where <span>$m$</span> and <span>$k$</span> are both integers. Then the first sum would be</p><p class="math-container">\[  \sum_{j=0}^{n-1} e^{2π\imath j(m-k)/n} = \sum_{j=0}^{n-1} e^{2π\imath jq/n}.\]</p><p>That&#39;s a signal that has period</p><p class="math-container">\[\frac{2π}{2πq/n} = n/q\]</p><p>that we&#39;re sampling <span>$n$</span> times. So we&#39;re sampling a sinusoid an integer number of times over its period, and summing it up. That will give us... zero. Same thing will happen to the second sum if <span>$m+k=r \ne 0$</span>: we&#39;ll also get zero. So now we just have to figure out what happens when <span>$m - k = 0$</span> and <span>$m + k = 0$</span>, i.e., when <span>$k ± m$</span>. Let&#39;s try <span>$k = m$</span> first. The first sum will be</p><p class="math-container">\[  \sum_{j=0}^{n-1} e^{2π\imath j(m-m)/n} = \sum_{j=0}^{n-1} e^{0} = \sum_{j=0}^{n-1} 1 = n\]</p><p>and the second sum will be </p><p class="math-container">\[  \sum_{j=0}^{n-1} e^{-2π\imath j(m+m)/n} = \sum_{j=0}^{n-1} e^{-4π\imath jm/n} = 0\]</p><p>from the previous discussion, since <span>$m+k=2m \ne 0$</span>.</p><p>For <span>$k = -m$</span>, the first sum will be zero, since <span>$m - -m = 2m \ne 0$</span>, and the second sum will be</p><p class="math-container">\[  \sum_{j=0}^{n-1} e^{2π\imath j(m-m))/n} = n\]</p><p>again.</p><p>Great! So now we finally can write down the DFT of our example signal</p><p class="math-container">\[p(t) = A \cos(ωt+φ) = A \cos\left(\left[\frac{2πm}{T}\right]t+φ\right),\]</p><p>which is (wish I could figure out how to do the <code>cases</code> LaTeX environment)...</p><p class="math-container">\[\begin{aligned}
  \hat{p}_m &amp; = \frac{A}{2}\left[\cos(φ) + \imath \sin(φ) \right] n \\
  \hat{p}_{-m} &amp; = \frac{A}{2}\left[\cos(φ) - \imath \sin(φ) \right] n \\
  \hat{p}_{k} &amp; = 0\,\text{otherwise}.
\end{aligned}\]</p><h3 id="Some-Special-Cases"><a class="docs-heading-anchor" href="#Some-Special-Cases">Some Special Cases</a><a id="Some-Special-Cases-1"></a><a class="docs-heading-anchor-permalink" href="#Some-Special-Cases" title="Permalink"></a></h3><p>There are two special cases that we need to consider: the mean component and the Nyquist component of the DFT. Let&#39;s try the mean component first.</p><h4 id="The-Mean-Component"><a class="docs-heading-anchor" href="#The-Mean-Component">The Mean Component</a><a id="The-Mean-Component-1"></a><a class="docs-heading-anchor-permalink" href="#The-Mean-Component" title="Permalink"></a></h4><p>So imagine if we start out with the same signal</p><p class="math-container">\[p(t) = A \cos(ωt+φ)\]</p><p>but say that <span>$ω = 0$</span>. Since <span>$ω = 2πm/T$</span>, that implies that <span>$m = 0$</span> also. But anyway, let&#39;s rewrite that in terms of powers of <span>$e$</span>:</p><p class="math-container">\[\begin{aligned}
p(t) &amp;= A \cos(ωt+φ) \\
     &amp;= \frac{A}{2}\left[\cos(φ) + \imath \sin(φ) \right] e^{\imath ωt} + \frac{A}{2}\left[\cos(φ) - \imath \sin(φ) \right] e^{-\imath ωt} \\
     &amp;= \frac{A}{2}\left[\cos(φ) + \imath \sin(φ) \right] e^{0} + \frac{A}{2}\left[\cos(φ) - \imath \sin(φ) \right] e^{0}\\
     &amp;= \frac{A}{2}\left[2\cos(φ)\right]\\
     &amp;= A\cos(φ).
\end{aligned}\]</p><p>What happens if we plug that into the definition of the discrete Fourier transform? We&#39;ll, it&#39;s not hard to see that we&#39;ll get</p><p class="math-container">\[\begin{aligned}
\hat{p}_0 &amp;= A\cos(φ)n \\
\hat{p}_k &amp;= 0 \,\text{otherwise}.
\end{aligned}\]</p><p>So the two takeaways are:</p><ul><li>the mean component doesn&#39;t contain a <span>$\frac{1}{2}$</span> factor</li><li>the mean component is always real</li></ul><p>Next, the Nyquist frequency component.</p><h4 id="Nyquist-Component"><a class="docs-heading-anchor" href="#Nyquist-Component">Nyquist Component</a><a id="Nyquist-Component-1"></a><a class="docs-heading-anchor-permalink" href="#Nyquist-Component" title="Permalink"></a></h4><p>The Nyquist component is the one with two samples per period, which corresponds to <span>$k=n/2$</span> in the DFT definition. It is the highest frequency component that the DFT can resolve. So that means our signal will look like</p><p class="math-container">\[\begin{aligned}
p(t) &amp;= A \cos(ωt+φ) \\
     &amp;= \frac{A}{2}\left[\cos(φ) + \imath \sin(φ) \right] e^{2π\imath jm/n} + \frac{A}{2}\left[\cos(φ) - \imath \sin(φ) \right] e^{-2π\imath jm/n} \\
     &amp;= \frac{A}{2}\left[\cos(φ) + \imath \sin(φ) \right] e^{2π\imath j(\frac{n}{2})/n} + \frac{A}{2}\left[\cos(φ) - \imath \sin(φ) \right] e^{-2π\imath j(\frac{n}{2})/n}
\end{aligned}\]</p><p>Now here&#39;s where things get a bit tricky. We&#39;ve got a <span>$\frac{n}{2}/n$</span> term that we&#39;d love to replace with <span>$\frac{1}{2}$</span>. That works fine if <span>$n$</span> is even, but what if <span>$n$</span> is odd? We&#39;ll have to look at both cases. First, the even case.</p><h4 id="Nyquist-Component-with-Even-Length-Input"><a class="docs-heading-anchor" href="#Nyquist-Component-with-Even-Length-Input">Nyquist Component with Even-Length Input</a><a id="Nyquist-Component-with-Even-Length-Input-1"></a><a class="docs-heading-anchor-permalink" href="#Nyquist-Component-with-Even-Length-Input" title="Permalink"></a></h4><p>If <span>$n$</span> is even, then we can do</p><p class="math-container">\[\begin{aligned}
p(t) &amp;= A \cos(ωt+φ) \\
     &amp;= \frac{A}{2}\left[\cos(φ) + \imath \sin(φ) \right] e^{2π\imath j(\frac{n}{2})/n} + \frac{A}{2}\left[\cos(φ) - \imath \sin(φ) \right] e^{-2π\imath j(\frac{n}{2})/n} \\
     &amp;= \frac{A}{2}\left[\cos(φ) + \imath \sin(φ) \right] e^{π\imath j} + \frac{A}{2}\left[\cos(φ) - \imath \sin(φ) \right] e^{-π\imath j}
\end{aligned}\]</p><p>and then realize that <span>$e^{π\imath j} = e^{-π\imath j} = \left(-1\right)^j$</span>, which let&#39;s us simplify a bit further to</p><p class="math-container">\[p(t) = \frac{A}{2}\left[2\cos(φ)]e^{π\imath j}\right] = A\cos(φ)e^{π\imath j}\]</p><p>The next step is to think about which components of the DFT we need to worry about. If we shove that into the DFT, we&#39;ll need to just focus on the <span>$e^{-2π\imath j (n/2)/n} = e^{-π\imath j}$</span> component of the DFT, and we&#39;ll eventually end up with</p><p class="math-container">\[\begin{aligned}
\hat{p}_{n/2} &amp;= A\cos(φ)n \\
\hat{p}_k &amp;= 0 \,\text{otherwise},
\end{aligned}\]</p><p>and so the takeaways are identical to the mean component:</p><ul><li>the Nyquist component for <span>$n$</span> even doesn&#39;t contain a <span>$\frac{1}{2}$</span> factor</li><li>the Nyquist component for <span>$n$</span> even is always real</li></ul><h4 id="Nyquist-Component-with-Odd-Length-Input"><a class="docs-heading-anchor" href="#Nyquist-Component-with-Odd-Length-Input">Nyquist Component with Odd-Length Input</a><a id="Nyquist-Component-with-Odd-Length-Input-1"></a><a class="docs-heading-anchor-permalink" href="#Nyquist-Component-with-Odd-Length-Input" title="Permalink"></a></h4><p>So, we&#39;re starting with </p><p class="math-container">\[\begin{aligned}
p(t) &amp;= A \cos(ωt+φ) \\
     &amp;= \frac{A}{2}\left[\cos(φ) + \imath \sin(φ) \right] e^{2π\imath j(\frac{n}{2})/n} + \frac{A}{2}\left[\cos(φ) - \imath \sin(φ) \right] e^{-2π\imath j(\frac{n}{2})/n}
\end{aligned}\]</p><p>Now, the trick here is that there <em>is</em> no Nyquist frequency component with an odd-input DFT. We&#39;ll never end up with <span>$e^{±2π\imath j(\frac{n}{2})/n} = e^{±π\imath}$</span> components in the DFT definition, since <span>$n$</span> is odd. For example, if <span>$n=9$</span>, the <span>$k$</span> in the original definition of the DFT</p><p class="math-container">\[  y_k = \sum_{j=0}^{n-1} x_j e^{-2 \pi \imath jk/n}\]</p><p>will never take on the value <span>$n/2$</span>, since that would be <span>$4\frac{1}{2}$</span> and <span>$k$</span> is an integer. So this special case isn&#39;t special for odd input lengths.</p><h3 id="Order-of-Outputs"><a class="docs-heading-anchor" href="#Order-of-Outputs">Order of Outputs</a><a id="Order-of-Outputs-1"></a><a class="docs-heading-anchor-permalink" href="#Order-of-Outputs" title="Permalink"></a></h3><p>We&#39;re almost ready to compare our example signal to the output of the FFTW library. The last thing we need to think about is how FFTW&#39;s output is ordered. FFT libraries have different conventions, but <a href="http://www.fftw.org/fftw3_doc/The-1d-Discrete-Fourier-Transform-_0028DFT_0029.html#The-1d-Discrete-Fourier-Transform-_0028DFT_0029">here is what FFTW does</a>:</p><blockquote><p>Note also that we use the standard “in-order” output ordering—the k-th output corresponds to the frequency k/n (or k/T, where T is your total sampling period). For those who like to think in terms of positive and negative frequencies, this means that the positive frequencies are stored in the first half of the output and the negative frequencies are stored in backwards order in the second half of the output. (The frequency -k/n is the same as the frequency (n-k)/n.)</p></blockquote><p>So for our original example signal</p><p class="math-container">\[\begin{aligned}
  p(t) &amp;= A \cos(ωt+φ) \\
  \hat{p}_m &amp; = \frac{A}{2}\left[\cos(φ) + \imath \sin(φ) \right] n \\
  \hat{p}_{-m} &amp; = \frac{A}{2}\left[\cos(φ) - \imath \sin(φ) \right] n \\
  \hat{p}_{k} &amp; = 0\,\text{otherwise}.
\end{aligned}\]</p><p>we would expect <span>$\hat{p}_m$</span> to appear in the <span>$1+m$</span> position (since <span>$m$</span> starts from 0, but the first &quot;position&quot; is 1 for Julia arrays), and <span>$\hat{p}_{-m}$</span> to appear in the <span>$1+n-m$</span> position. But things get a bit more complicated if we use a real-input FFT (which AcousticMetrics.jl does). See the next section.</p><h3 id="Real-Input-FFTs-and-Half-Complex-Format"><a class="docs-heading-anchor" href="#Real-Input-FFTs-and-Half-Complex-Format">Real-Input FFTs and Half-Complex Format</a><a id="Real-Input-FFTs-and-Half-Complex-Format-1"></a><a class="docs-heading-anchor-permalink" href="#Real-Input-FFTs-and-Half-Complex-Format" title="Permalink"></a></h3><p>If we look back at the results for the DFT of our simple signal</p><p class="math-container">\[\begin{aligned}
  p(t) &amp;= A \cos(ωt+φ) \\
  \hat{p}_m &amp; = \frac{A}{2}\left[\cos(φ) + \imath \sin(φ) \right] n \\
  \hat{p}_{-m} &amp; = \frac{A}{2}\left[\cos(φ) - \imath \sin(φ) \right] n \\
  \hat{p}_{k} &amp; = 0\,\text{otherwise}.
\end{aligned}\]</p><p>we can&#39;t help but notice that the negative and positive frequency results are closely related. If we know one, we can figure out the other. And if we want to find <span>$A$</span> and <span>$φ$</span>, we just need either the positive or negative result. For example, if <span>$a_r$</span> and <span>$a_i$</span> are the real and imaginary parts of <span>$\hat{p}_m$</span>, respectively, then</p><p class="math-container">\[A = \frac{2}{n}\sqrt{a_r^2 + a_i^2}\]</p><p>and</p><p class="math-container">\[φ = \arctan(a_i/a_r).\]</p><p>For the Nyquist frequency, though, we know that</p><p class="math-container">\[\begin{aligned}
\hat{p}_{n/2} &amp;= A\cos(φ)n \\
\hat{p}_k &amp;= 0 \,\text{otherwise},
\end{aligned}\]</p><p>and so <span>$a_r = A\cos(φ)n$</span> and <span>$a_i = 0$</span>. We have only one non-zero component, so we&#39;ll have to define </p><p class="math-container">\[A = a_r/n\]</p><p>and</p><p class="math-container">\[φ = 0.\]</p><p>Or, wait, maybe it would be better to make <code>A = abs(a_r)/n</code> and <code>φ = π</code> if <code>a_r &lt; 0</code>, and <code>φ = 0</code> otherwise.</p><p>So, for real-input FFTs, FFTW only gives you the non-negative frequencies of the DFT. Finally, if we want to avoid complex numbers entirely, we can use the &quot;real-to-real&quot; transform that returns the DFT in the <a href="https://www.fftw.org/fftw3_doc/The-Halfcomplex_002dformat-DFT.html">halfcomplex format</a>. This returns the frequencies in an order similar to the standard in-order manner discussed previously, but only returns the non-negative portion of the spectrum. Specifically, the FFTW manual shows that the order of outputs will be</p><p class="math-container">\[r_0, r_1, r_2, ..., r_{n/2}, i_{(n+1)/2-1}, ..., i_2, i_1\]</p><p>where <span>$r_k$</span> and <span>$i_k$</span> are the real and imaginary parts of component <span>$k$</span>, and division by 2 is rounded down. An example makes this a bit more clear. Let&#39;s imagine we have a signal of length 8, so <span>$n = 8$</span>. Then the output we&#39;ll get from FFTW will be </p><p class="math-container">\[r_0, r_1, r_2, r_3, r_4, i_3, i_2, i_1\]</p><p><span>$i_0$</span> and <span>$i_4$</span> are &quot;missing,&quot; but that doesn&#39;t bother us since we know that both of those are always zero for a real-input even-length DFT.</p><p>What if we had an odd-length input signal? Let&#39;s try <span>$n=9$</span> this time. Then the output will be </p><p class="math-container">\[r_0, r_1, r_2, r_3, r_4, i_4, i_3, i_2, i_1\]</p><p>This time the <span>$i_4$</span> component isn&#39;t &quot;missing,&quot; which is a good thing, since it&#39;s not zero.</p><h3 id="Time-Offset"><a class="docs-heading-anchor" href="#Time-Offset">Time Offset</a><a id="Time-Offset-1"></a><a class="docs-heading-anchor-permalink" href="#Time-Offset" title="Permalink"></a></h3><p>So far we&#39;ve been assuming that the time <span>$t$</span> starts at 0. What if that&#39;s not true, i.e., that <span>$t_j = t_0 + j\frac{T}{n}$</span>? Then</p><p class="math-container">\[ω t_j = \left( \frac{2πm}{T} \right) \left(t_0 + j \frac{T}{n} \right) = \frac{2πm t_0}{T} + \frac{2πmj}{n}\]</p><p>and the signal is now</p><p class="math-container">\[\begin{aligned}
p(t_j) = p_j &amp;= A\cos(ω[t_0 + j\frac{T}{n}] + φ) \\
             &amp;= \frac{A}{2}\left[ \cos(φ) + \imath \sin(φ)\right] e^{2π\imath m t_0/T + 2π\imath jm/n} + \frac{A}{2}\left[ \cos(φ) - \imath \sin(φ)\right] e^{-2π\imath m t_0/T - 2π\imath jm/n} \\
             &amp;= \frac{A}{2}\left[ \cos(φ) + \imath \sin(φ)\right] e^{2π\imath m t_0/T} e^{2π\imath jm/n} + \frac{A}{2}\left[ \cos(φ) - \imath \sin(φ)\right] e^{-2π\imath m t_0/T} e^{-2π\imath jm/n}.
\end{aligned}\]</p><p>Next, we substitute the signal into the definition of the DFT:</p><p class="math-container">\[\begin{aligned}
  \hat{p}_k &amp;= \sum_{j=0}^{n-1} p_j e^{-2 \pi \imath jk/n} \\
            &amp;=\frac{A}{2}\left[\cos(φ) + \imath \sin(φ) \right] e^{2π\imath m t_0/T} \sum_{j=0}^{n-1} e^{2π\imath j(m-k)/n} + \frac{A}{2}\left[\cos(φ) - \imath \sin(φ) \right] e^{-2π\imath m t_0/T} \sum_{j=0}^{n-1} e^{-2π\imath j(m+k)/n} 
\end{aligned}\]</p><p>then use the same arguments we used before for the summations to find that</p><p class="math-container">\[\begin{aligned}
  \hat{p}_m &amp; = \frac{A}{2}\left[\cos(φ) + \imath \sin(φ) \right] e^{2π\imath m t_0/T} n \\
  \hat{p}_{-m} &amp; = \frac{A}{2}\left[\cos(φ) - \imath \sin(φ) \right] e^{-2π\imath m t_0/T} n \\
  \hat{p}_{k} &amp; = 0\,\text{otherwise}.
\end{aligned}\]</p><p>Let&#39;s work on the non-zero <span>$\hat{p}$</span> components a bit. First, the positive-<span>$m$</span> one:</p><p class="math-container">\[\begin{aligned}
  \hat{p}_m &amp; = \frac{A}{2}\left[\cos(φ) + \imath \sin(φ) \right] e^{2π\imath m t_0/T} n \\
            &amp; = \frac{A}{2}\left[e^{\imath φ} \right] e^{2π\imath m t_0/T} n \\
            &amp; = \frac{A}{2}\left[e^{\imath φ + 2π\imath m t_0/T} \right] n \\
            &amp; = \frac{A}{2}\left[e^{\imath (φ + 2π m t_0/T)} \right] n \\
            &amp; = \frac{A}{2}\left[\cos(φ + 2π m t_0/T) + \imath \sin(φ+ 2π m t_0/T) \right] n
\end{aligned}\]</p><p>Then, the negative-<span>$m$</span> one:</p><p class="math-container">\[\begin{aligned}
  \hat{p}_{-m} &amp; = \frac{A}{2}\left[\cos(φ) - \imath \sin(φ) \right] e^{-2π\imath m t_0/T} n \\
               &amp; = \frac{A}{2}\left[e^{-\imath φ} \right] e^{-2π\imath m t_0/T} n \\
               &amp; = \frac{A}{2}\left[e^{-\imath φ - 2π\imath m t_0/T} \right] n \\
               &amp; = \frac{A}{2}\left[e^{-\imath (φ + 2π m t_0/T)} \right] n \\
               &amp; = \frac{A}{2}\left[\cos(φ + 2π m t_0/T) - \imath \sin(φ+ 2π m t_0/T) \right] n
\end{aligned}\]</p><p>So now, if we want to find <span>$A$</span> and <span>$φ$</span> from the <span>$\hat{p}_m$</span> components <span>$a_r$</span> </p><p class="math-container">\[a_r = \frac{A}{2}\cos(φ + 2π m t_0/T)n\]</p><p>and <span>$a_i$</span></p><p class="math-container">\[a_i = \frac{A}{2}\sin(φ + 2π m t_0/T)n\]</p><p>we can use the same formula for <span>$A$</span></p><p class="math-container">\[A = \frac{2}{n}\sqrt{a_r^2 + a_i^2}\]</p><p>and a slightly modified version of the formula for <span>$φ$</span></p><p class="math-container">\[φ = \arctan(a_i/a_r) - 2π m t_0/T.\]</p><p>And we don&#39;t need to worry about the two special cases discussed previously, since the <span>$φ$</span> angle for both the mean and Nyquist components is always zero. What about the special cases we discussed previously (the mean and the Nyquist frequencies)? Obviously shifting the mean component shouldn&#39;t change anything. But what about the Nyquist frequency?</p><h4 id="Nyquist-Component-with-a-Time-Offset"><a class="docs-heading-anchor" href="#Nyquist-Component-with-a-Time-Offset">Nyquist Component with a Time Offset</a><a id="Nyquist-Component-with-a-Time-Offset-1"></a><a class="docs-heading-anchor-permalink" href="#Nyquist-Component-with-a-Time-Offset" title="Permalink"></a></h4><p>We know from previous work that the odd-input length Nyquist component isn&#39;t special, so we&#39;ll ignore that case. So, for the even-input length Nyquist component, we&#39;ll start with the same signal</p><p class="math-container">\[\begin{aligned}
p(t_j) = p_j &amp;= \frac{A}{2}\left[ \cos(φ) + \imath \sin(φ)\right] e^{2π\imath m t_0/T + 2π\imath jm/n} + \frac{A}{2}\left[ \cos(φ) - \imath \sin(φ)\right] e^{-2π\imath m t_0/T - 2π\imath jm/n} \\
             &amp;= \frac{A}{2}\left[ \cos(φ) + \imath \sin(φ)\right] e^{2π\imath m t_0/T} e^{2π\imath jm/n} + \frac{A}{2}\left[ \cos(φ) - \imath \sin(φ)\right] e^{-2π\imath m t_0/T} e^{-2π\imath jm/n},
\end{aligned}\]</p><p>and then say that <span>$m = n/2$</span>, like previously</p><p class="math-container">\[\begin{aligned}
  p_j &amp;= \frac{A}{2}\left[ \cos(φ) + \imath \sin(φ)\right] e^{2π\imath (n/2) t_0/T} e^{2π\imath j(n/2)/n} + \frac{A}{2}\left[ \cos(φ) - \imath \sin(φ)\right] e^{-2π\imath (n/2) t_0/T} e^{-2π\imath j(n/2)/n} \\
      &amp;= \frac{A}{2}\left[ \cos(φ) + \imath \sin(φ)\right] e^{π\imath n t_0/T} e^{π\imath j} + \frac{A}{2}\left[ \cos(φ) - \imath \sin(φ)\right] e^{-π\imath n t_0/T} e^{-π\imath j} \\
      &amp;= \frac{A}{2}\left[e^{\imath φ}\right] e^{π\imath n t_0/T} e^{π\imath j} + \frac{A}{2}\left[ e^{-\imath φ}\right] e^{-π\imath n t_0/T} e^{-π\imath j} \\
      &amp;= \frac{A}{2}\left[e^{\imath (φ + πn t_0/T)}\right] e^{π\imath j} + \frac{A}{2}\left[ e^{-\imath (φ + πn t_0/T)}\right] e^{-π\imath j} \\
      &amp;= \frac{A}{2}\left[\cos(φ + πn t_0/T) + \imath \sin(φ + πn t_0/T)\right] e^{π\imath j} + \frac{A}{2}\left[ \cos(φ + πn t_0/T) - \imath \sin(φ + πn t_0/T)\right] e^{-π\imath j} \\
      &amp;= A\cos(φ + πn t_0/T)e^{π\imath j} \\
      &amp;= A\cos(φ + 2π (n/2) t_0/T)e^{2π\imath j (n/2)/n}
\end{aligned}\]</p><p>So this means the Fourier transform is</p><p class="math-container">\[\hat{p}_{n/2} = A\cos(φ + 2π (n/2) t_0/T) n\]</p><p>and so we can find</p><p class="math-container">\[A = a_r/n\]</p><p>and</p><p class="math-container">\[φ = -2π(n/2) t_0/T.\]</p><h3 id="What-if-the-signal-frequency-isn&#39;t-a-multiple-of-the-sampling-frequency?"><a class="docs-heading-anchor" href="#What-if-the-signal-frequency-isn&#39;t-a-multiple-of-the-sampling-frequency?">What if the signal frequency isn&#39;t a multiple of the sampling frequency?</a><a id="What-if-the-signal-frequency-isn&#39;t-a-multiple-of-the-sampling-frequency?-1"></a><a class="docs-heading-anchor-permalink" href="#What-if-the-signal-frequency-isn&#39;t-a-multiple-of-the-sampling-frequency?" title="Permalink"></a></h3><p class="math-container">\[p(t) = A \cos(ωt+φ)\]</p><p>Say we evaluate that function <span>$n$</span> times over a period <span>$T$</span>, just like before. But this time we will assume that <span>$ω = 2π(m+a)/T$</span> where <span>$0 \lt a \lt 1$</span>, i.e., that the period of our signal is <em>not</em> some integer fraction of the sampling period <span>$T$</span>. What will the Fourier transform of that be?</p><p>We can reuse a bunch of our previous work. This expression for the signal <span>$p(t)$</span> still applies:</p><p class="math-container">\[p(t) = \frac{A}{2}\left[ \cos(φ) + \imath \sin(φ)\right] e^{\imath ωt} + \frac{A}{2}\left[ \cos(φ) - \imath \sin(φ)\right] e^{-\imath ωt}\]</p><p>But now we just need to substitute our new expression for <span>$ω t_j$</span>,</p><p class="math-container">\[ω t_j = \left( \frac{2π(m+a)}{T} \right) \left(j \frac{T}{n} \right) = \frac{2π(m+a)j}{n},\]</p><p>which will give us</p><p class="math-container">\[p(t_j) = p_j = \frac{A}{2}\left[ \cos(φ) + \imath \sin(φ)\right] e^{2π\imath j(m+a)/n} + \frac{A}{2}\left[ \cos(φ) - \imath \sin(φ)\right] e^{-2π\imath j(m+a)/n}\]</p><p>Now, if we do the FFT:</p><p class="math-container">\[\begin{aligned}
  \hat{p}_k &amp;= \sum_{j=0}^{n-1} p_j e^{-2 \pi \imath jk/n} \\
            &amp;= \sum_{j=0}^{n-1} \left( \frac{A}{2}\left[\cos(φ) + \imath \sin(φ) \right] e^{2π\imath j(m+a)/n} + \frac{A}{2}\left[\cos(φ) - \imath \sin(φ) \right] e^{-2π\imath j(m+a)/n} \right) e^{-2 \pi \imath jk/n} \\
            &amp;= \sum_{j=0}^{n-1} \left( \frac{A}{2}\left[\cos(φ) + \imath \sin(φ) \right] e^{2π\imath j(m+a-k)/n} + \frac{A}{2}\left[\cos(φ) - \imath \sin(φ) \right] e^{-2π\imath j(m+a+k)/n} \right) \\
            &amp;=\frac{A}{2}\left[\cos(φ) + \imath \sin(φ) \right] \sum_{j=0}^{n-1} e^{2π\imath j(m+a-k)/n} + \frac{A}{2}\left[\cos(φ) - \imath \sin(φ) \right] \sum_{j=0}^{n-1} e^{-2π\imath j(m+a+k)/n} \\
            &amp;=\frac{A}{2}\left[\cos(φ) + \imath \sin(φ) \right] \sum_{j=0}^{n-1} e^{2π\imath j(m-k)/n} e^{2π\imath aj/n} + \frac{A}{2}\left[\cos(φ) - \imath \sin(φ) \right] \sum_{j=0}^{n-1} e^{-2π\imath j(m+k)/n}  e^{2π\imath aj/n}
\end{aligned}\]</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../api/">« API</a><a class="docs-footer-nextpage" href="../sqa/">Software Quality Assurance »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Tuesday 2 July 2024 13:18">Tuesday 2 July 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
